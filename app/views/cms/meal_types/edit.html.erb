<%= stylesheet_link_tag "cms_custom" %>

<% if @meal_type.errors.any? %>
    <div id="errorExplanation" class="errorExplanation">
      <ul>
        <% @meal_type.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
<% end %>

<%= form_for @meal_type, :url => "/cms/meal_types/#{@meal_type.id}" do |f| %>
	<div class="fields text_fields">		
		<label for="meal_type_name">Name</label>
		<%= f.text_field :name, :disabled => true %>		
	</div>	
	<div class="fields select_fields">
		<label for="meal_type_from">From</label>
		<%= f.select :from, TIME_ARR %>		
	</div>	
	<div class="fields select_fields">
		<label for="meal_type_to">To</label>	
		<%= f.select :to, TIME_ARR %>		
	</div>	
	<div class="fields select_fields">
		<label for="meal_type_from_display">From Display</label>
		<%= f.select :from_display, TIME_ARR %>
	</div>	
	<div class="fields select_fields">
		<label for="meal_type_to_display">To Display</label>
		<%= f.select :to_display, TIME_ARR %>	
	</div>	
	<div class="fields select_fields">
		<label for="meal_type_is_active">Is Active</label>
		<%= f.check_box :is_active %>		
	</div>
	<div class="fields select_fields">
		<% if @meal_type.first_slot != '0 - 0' || @meal_type.second_slot != '0 - 0' || @meal_type.third_slot != '0 - 0' %>
			<b>Added Delivery Slots are:</b><br/><br/>
			<% if @meal_type.first_slot != '0 - 0' %>
				First Slot : <%= @meal_type.first_slot %><br/><br/>
			<% end %>	
			<% if @meal_type.second_slot != '0 - 0' %>
				Second Slot : <%= @meal_type.second_slot %><br/><br/>
			<% end %>	
			<% if @meal_type.third_slot != '0 - 0' %>
				Third Slot : <%= @meal_type.third_slot %>
			<% end %><br/><br/>
		<% end %>
	</div>
	<div class="fields text_fields">		
		<a id="add_slots">Add/Edit Slots </a> <br/><br/>
	</div>			

	<div id="slots_div" class="hide">
		<% for i in 1..3 %>
			<div id="select_container_<%= i %>" class="fields text_fields">
				<label> 
					<% if i == 1 %>
						First
					<% elsif i == 2 %>			
						Second	
					<% else %>
						Third
					<% end %>		
					slot
				</label>				
				<label for="from_slot_<%= i %>">From</label>
				<select name="from_slot_<%= i %>" id="from_slot_<%= i %>">
					<option value="0">Select Time</option>
					<% TIME.each do |key, value| %>
						<option value="<%= key %>"><%= key %></option>
					<% end %>	
				</select><br/><br/><br/>
				<label></label>
				<label for="to_slot_<%= i %>">To</label>
	  			<select name="to_slot_<%= i %>" id="to_slot_<%= i %>">
	  				<option value="0">Select Time</option>
	  				<% TIME.each do |key, value| %>
	  					<option value="<%= key %>"><%= key %></option>
	  				<% end %>	
	  			</select>  		  			
	  		</div>	
		<% end %>
	</div>	
	<div class="fields text_fields">		
		<input type="hidden" name="slot_updated" id="slot_updated" value="false"/>
		<%= f.button "SUBMIT" %>
	</div>	
<% end %>

<style type="text/css">	
	.hide{
		display: none;
	}
</style>

<script type="text/javascript">
    function set_options(index_for_slicing, ele_to_be_affected){ 
        time_arr = ['12AM', ' 1AM', ' 2AM', ' 3AM', ' 4AM', ' 5AM', ' 6AM', ' 7AM', ' 8AM', ' 9AM', '10AM', '11AM', '12PM', ' 1PM', ' 2PM', ' 3PM', ' 4PM', ' 5PM', ' 6PM', ' 7PM', ' 8PM', ' 9PM', '10PM', '11PM'] 
        options = "";
        options += "<option value='0'>Select Time</option>";
        sub_arr = time_arr.slice($.inArray(index_for_slicing,time_arr) + 1);        
        for(var i = 0; i < sub_arr.length; i++) 
            options += "<option value='" + sub_arr[i] + "'>" + sub_arr[i] + "</option>";
        $('#'+ ele_to_be_affected +' option').remove();         
        $('#'+ ele_to_be_affected).html(options);
    }   

	$(document).ready(function(){
		$('#add_slots').click(function(){
			$('#slots_div').removeClass('hide');
			$('#slot_updated').val('true');
		})

		$('#from_slot_1').change(function(){    	
        	set_options($(this).val(), 'to_slot_1');
    	});

    	$('#to_slot_1').change(function(){
        	set_options($(this).val(), 'from_slot_2');          
    	});

    	$('#from_slot_2').change(function(){    
        	set_options($(this).val(), 'to_slot_2');
    	});

	    $('#to_slot_2').change(function(){
    	    set_options($(this).val(), 'from_slot_3');                  
    	});

    	$('#from_slot_3').change(function(){
        	set_options($(this).val(), 'to_slot_3');
    	});

	})

</script>